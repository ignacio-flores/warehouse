name: Validate Sources Registry

on:
  pull_request:
  push:
    branches: [main, master]

permissions:
  contents: read

jobs:
  validate-sources:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Validate canonical registry and generated outputs
        run: |
          python3 code/tools/sources/validate_sources.py \
            --registry metadata/sources/sources.yaml \
            --schema metadata/sources/schema.json \
            --aliases metadata/sources/aliases.yaml \
            --change-log metadata/sources/change_log.yaml \
            --check-generated \
            --dictionary handmade_tables/dictionary.xlsx \
            --bib metadata/sources/GCWealthProject_DataSourcesLibrary.bib
